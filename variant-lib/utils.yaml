#!/usr/bin/env variant
# vi: ft=yaml

parameters:
- name: working_dir
  default: docroot

tasks:
  init:
    parameters:
    - name: user_email
      type: string
      default: "toolbox@toolbox.com"
    - name: user_name
      type: string
      default: "Toolbox"
    steps:
    - task: core.exec
      arguments:
        cmd: |
          git config --global user.email "{{ .user_email }}"
          git config --global user.name "{{ .user_name }}"

          mkdir -p {{ .working_dir }}/config
          cp toolbox/config/rendered/config.yaml {{ .working_dir }}/config

  deliverables:
    parameters:
    - name: state
      type: string
    steps:
    - task: utils.build.init
    - task: core.exec
      arguments:
        cmd: |
          cd .docroot
          docman build git_target {{ .state }}



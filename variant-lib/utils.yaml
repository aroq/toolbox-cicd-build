#!/usr/bin/env variant
# vi: ft=yaml

parameters:
- name: working_dir
  default: .docroot

tasks:
  init:
    parameters:
    - name: user_email
      type: string
      default: "toolbox@toolbox.com"
    - name: user_name
      type: string
      default: "Toolbox"
    steps:
    - task: core.exec
      arguments:
        title: Initialization
        cmd: |
          git config --global user.email "{{ .user_email }}"
          git config --global user.name "{{ .user_name }}"

          rm -fR {{ .working_dir }}
          mkdir -p {{ .working_dir }}

  branch:
    script: |
      if [ -z ${CI_COMMIT_REF_NAME+x} ]; then
        git symbolic-ref -q --short HEAD || git describe --tags --exact-match
      else
        echo ${CI_COMMIT_REF_NAME}
      fi

